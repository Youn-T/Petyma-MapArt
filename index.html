<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Pixels en cha√Æne</title>
</head>
<body>

<h2>Uploader une image</h2>
<input type="file" id="uploader" accept="image/*">
<pre id="output" style="white-space:pre-wrap; max-height:400px; overflow:auto;"></pre>

<canvas id="canvas" style="display:none;"></canvas>

<script>
function distanceRGB(c1, c2) {
  return Math.sqrt(
    Math.pow(c1[0] - c2[0], 2) +
    Math.pow(c1[1] - c2[1], 2) +
    Math.pow(c1[2] - c2[2], 2)
  );
}

function couleurProche(couleurUtilisateur, palette) {
  let couleurLaPlusProche = palette[0];
  let distanceMin = distanceRGB(couleurUtilisateur, couleurLaPlusProche);

  for (let i = 1; i < palette.length; i++) {
    const dist = distanceRGB(couleurUtilisateur, palette[i]);
    if (dist < distanceMin) {
      distanceMin = dist;
      couleurLaPlusProche = palette[i];
    }
  }

  return couleurLaPlusProche;
}

const palette = [
    (255,0,0),
    (0,255,0),
    (0,0,255),
    (0,0,0),
    (255,255,255)
]

const correspondances = [
    "minecraft:red_wool",
    "minecraft:green_wool",
    "minecraft:blue_wool",
    "minecraft:black_wool",
    "minecraft:white_wool"

]

document.getElementById("uploader").addEventListener("change", function(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();

  reader.onload = function(e) {
    const img = new Image();
    img.onload = function() {
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      canvas.width = img.width;
      canvas.height = img.height;

      ctx.drawImage(img, 0, 0);

      const imageData = ctx.getImageData(0, 0, img.width, img.height);
      const data = imageData.data;

      let pixelString = "";

      for (let i = 0; i < data.length; i += 4) {
        const r = data[i];
        const g = data[i + 1];
        const b = data[i + 2];
        const rgb = (r,g,b)
        let nearest = couleurProche(rgb,palette)

        pixelString += `( ${nearest[0]}, ${nearest[1]}, ${nearest[2]} ) `;
      }

      document.getElementById("output").textContent = pixelString;
    };

    img.src = e.target.result;
  };

  reader.readAsDataURL(file);
});
</script>

</body>
</html>
